<!--
   $FML: cgi.sgml,v 1.7 2004/10/06 09:07:42 fukachan Exp $
-->


<chapter id="setupcgi">
	<title>
	CGI の設定
	</title>


<warning>

<para>
CGI の内部構造については
<link linkend="cgi.internal.method">
<xref linkend="cgi.internal.method">
</link>
を参照して下さい。
</para>

<para>
<link linkend="setup.apache.suexec">
apache で suexec を使う
</link>
ことを前提としています。
</para>

<para>
2004 年、秋現在、ＭＬごとの CGI およびドメイン全体を管理する CGI が用
意されています。このインターフェイスで、ユーザの追加、削除、メンバーリ
ストやログの閲覧などが可能ですが、CGI からの設定変更インターフェイス(
config.cf の編集機能)が未実装です。
</para>

<para>
なお、CGI から設定変更を行なう場合でも、メールサーバとして postfix や 
qmail を使っているなら、CGI 用の特別な「メールサーバの設定変更」は不要
です。
</para>

</warning>


<sect1 id="setupcgi.install">
	<title>
	いつでも makefml newml は CGI スクリプトを作ります
	</title>

<para>
makefml newml を実行するとデフォルトで config.cgi などの CGI スクリプ
トが ~fml/public_html/ 以下に用意されています。この CGI は二種類あり、
ドメイン全体を管理する CGI と、それぞれのＭＬを管理する CGI と両方あり
ます。
<screen>
そのドメインのＭＬ全部の管理者用
~fml/public_html/fml/ドメイン/admin/config.cgi

ＭＬごとの管理者用
~fml/public_html/fml/ドメイン/ml-admin/config.cgi
</screen>
</para>

<para>
例えば、elena@fml.org ＭＬを作成すると
fml.org の全ＭＬを管理する CGI スクリプト
<screen>
http://lists.fml.org/~fml/cgi-bin/fml/ドメイン/admin/config.cgi

例
http://lists.fml.org/~fml/cgi-bin/fml/fml.org/admin/config.cgi
</screen>
と elena ML だけを管理する CGI スクリプト
<screen>
http://lists.fml.org/~fml/cgi-bin/fml/ドメイン/ml-admin/ＭＬ名/config.cgi

例
http://lists.fml.org/~fml/cgi-bin/fml/fml.org/ml-admin/elena/config.cgi
</screen>
の両方が makefml により用意されます。
</para>

<para>
<graphic entityref="image.cgi.newml"></graphic>
</para>

</sect1>


<sect1 id="setupcgi.htaccess">
	<title>
	.htaccess を編集する
	</title>

<para>
デフォルトでは、CGI のアクセスを拒否するようにドメイン単位で
.htaccess が作られます。
<screen>
http://lists.fml.org/~fml/cgi-bin/fml/ドメイン/.htaccess

例
http://lists.fml.org/~fml/cgi-bin/fml/fml.org/.htaccess
</screen>
</para>

<para>
デフォルトの .htaccess は次のような無意味:)なものになっていて、
アクセスできません。
<footnote>
<para>
さらに、デフォルトの apache では ~fml/ へのアクセスは出来ないはずなの
で、apache の設定も別途必要です。一応、この二段構えになっています。
</para>
</footnote>
<screen>
AuthName ByPassword
AuthType Basic
require valid-user
</screen>
この .htaccess を適切なものに書き換えて下さい。
<screen>
例

AuthName ByPassword
AuthType Basic
AuthUserConfig "/usr/local/etc/fml/ドメイン/htpasswd"
require valid-user
</screen>
</para>

<warning>
<para>
(当たり前だけど)このファイルを消すと、誰でもアクセスできるようになりま
す。デバッグする場合はともかく、そういう裏技は使わないようにしましょう;-)
また、そういうデバッグなんて時に限って、そのまま再設定し忘れたりするも
のなので、しない方が良いです。きちんと .htaccess を設定しましょう。
</para>
</warning>

</sect1>


<sect1 id="setupcgi.admin.cgi.overview">
	<title>
	例: ドメインマスタ CGI の画面
	</title>

<para>
この CGI は
「makefml を実行できる権限を与えても良いけれど、
でも、UNIX のコマンドラインを使うのがちょっと辛い」
という人を想定しています。
よって、ＭＬの作成などができるわけですが、
makefml のすべての機能が使えるわけでもありません。 
</para>

<para>
画面を見るとわかる通り、
CGI で可能な項目は makefml のサブセットとなっています。
なお、使用可能なコマンドは最初の画面にヘルプとして表示されています。
<screen>
例: CGI トップ画面

                     @home.fml.org CGI for configuration

fml admin menu             fml CGI interface for @home.fml.org ML's
mailing list:
[elena]              左のナビゲーションバーから、ＭＬ(mailing list)とコマ
command:             ンド(command)を選択し、 submit ボタンを押して下さい
[subscribe  ]        。
[submit][reset]
                     subscribe   アドレスの追加
                     unsubscribe アドレスの削除
                     addadmin    リモート管理者アドレスの追加
                     byeadmin    リモート管理者アドレスの削除
options Language:    list        アドレスリストを見る
[Japanese] [change]  log         ログを見る
                     newml       ＭＬの作成
                     rmml        ＭＬの削除
</screen>
</para>


<para>
なお、画面の左下もしくは右にヘルプメッセージが表示されるので
それを参考にして下さい。
もちろんコマンドごとにメッセージは異なります:)
</para>

<para>
<graphic entityref="image.cgi.top"></graphic>
</para>


</sect1>


<sect1 id="setupcgi.admin.cgi.newml">
	<title>
	CGI の使い方の例: ＭＬの作成
	</title>

<para>
左の画面のコマンドで newml を選択し、
submit ボタンを押して下さい。
ML 名を選択する必要はありません:)
</para>

<para>
中央に、ＭＬ名の入力を促す画面が現れるので、
作成するＭＬ名を入力し、中央の submit ボタンを押して下さい。
</para>

<para>
<graphic entityref="image.cgi.newml"></graphic>
</para>

</sect1>


<sect1 id="setupcgi.admin.cgi.subscribe">
	<title>
	CGI の使い方の例: メンバー登録
	</title>

<para>
左の画面のコマンドで ML 名と subscribe を選択し、
submit ボタンを押して下さい。
</para>

<para>
中央に、アドレスの入力を促す画面が現れるので、
登録したいアドレスを入力し、
中央の submit ボタンを押して下さい。
</para>

<para>
<graphic entityref="image.cgi.useradd"></graphic>
</para>

</sect1>


<sect1 id="setupcgi.admin.cgi.skin">
	<title>
	CGI スキンの選択
	</title>	

<para>
config.cgi では TABLE と SELECT が基本です。
もう少し、昔風の画面にしたいなら、menu.cgi のほうを使ってみて下さい。
<screen>
そのドメインのＭＬ全部の管理者用
~fml/public_html/fml/ドメイン/admin/menu.cgi

ＭＬごとの管理者用
~fml/public_html/fml/ドメイン/ml-admin/menu.cgi
</screen>
</para>

</sect1>


</chapter>
