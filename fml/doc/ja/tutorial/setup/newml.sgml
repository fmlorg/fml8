<!--
   $FML: newml.sgml,v 1.7 2004/04/07 11:07:11 fukachan Exp $
-->


<chapter id="setup.newml">
	<title>
	UNIX 上でＭＬを作成する
	</title>


<sect1 id="setup.newml.default">
	<title>
	makefml newml でＭＬを作る (デフォルトドメインの場合)
	</title>

<caution>
<para>
デフォルトドメインの場合、&fml4 と同じで構いません。
バーチャルドメインを使う場合、ちょっと違います。
次節を参照して下さい。
</para>
</caution>

<para>
makefml を使ってＭＬを作成します。
使い方は &fml4; と同様です。
<screen>
% su fml
% makefml newml elena
   ... 処理の様子が出力される(略) ...
</screen>
デフォルトの/var/spool/ml以外にパスを切替えたい場合は
makefml newdomain コマンドでパスを指定して下さい。
<screen>
% su root
# makefml newdomain fml.org /var/spool/virtual/fml.org
# exit
% su fml
% makefml newml elena
   ... 処理の様子が出力される(略) ...
</screen>

</para>


<para>
この時、makefml newml は以下のような処理をします。

<itemizedlist>

   <listitem>
        <para>
	/var/spool/ml/elena に
	<screen>
	config.cf
	include
	include-ctl
	</screen>
	などを作る(適宜、elena やドメインの値を変換しながら)
        </para>
   </listitem>

   <listitem>
        <para>
	/var/spool/ml/etc/mail/aliases に elena の設定を仕込む。
	postalias コマンドで
	/var/spool/ml/etc/mail/aliases.db を再生成する。
        </para>
   </listitem>

   <listitem>
        <para>
	~fml/.qmail-* ファイル群を生成する。
        </para>
   </listitem>

   <listitem>
        <para>
	procmailrc の見本を作る。
        </para>
   </listitem>

   <listitem>
        <para>
	HTML 化された記事を置く場所として以下の階層を用意する/作る。
	<screen>
	~fml/public_html/fml/mlarchive/$domain/$ml/
	</screen>
	例えば elena@fml.org なら
	<screen>
	~fml/public_html/fml/mlarchive/fml.org/elena/
	</screen>
	を用意する。
	デフォルトでは、
	ここに HTML 化された記事が自動的に作られることになる。
        </para>
   </listitem>

   <listitem>
        <para>
	CGI インターフェイスを用意する。
	ドメインで一番偉いインターフェイス(そのドメインのＭＬは全部操
	作できる)が
	<screen>
	~fml/public_html/cgi-bin/fml/$domain/admin/config.cgi
	</screen>
	また、各ＭＬで一番偉いインターフェイス(そのＭＬの操作ができる)
	<screen>
	~fml/public_html/cgi-bin/fml/$domain/ml-admin/$ml/config.cgi
	</screen>
        </para>
   </listitem>

</itemizedlist>
</para>

</sect1>


<sect1 id="setup.newml.nondefault">
	<title>
	makefml newml でＭＬを作る (デフォルトドメインでは"ない"場合)
	</title>

<caution>
<para>
デフォルトドメインではない場合、&fml4 と異なります。
注意点は、最初に newdomain コマンドを使うところとＭＬ名です。
</para>
</caution>

<para>
makefml を使ってＭＬを作成します。
使い方は &fml4; と同様ですが、ＭＬ名にきちんとドメインまでつけて下さい。
<screen>
初回は、newdomain コマンドによるドメイン定義も必要です。
% su root
# makefml newdomain nuinui.net /var/spool/virtual/nuinui.net
# exit
% su fml
% makefml newml elena@nuinui.net

二回目以降の場合は

% su fml
% makefml newml elena@nuinui.net

だけでよいです。
</screen>
</para>

<para>
newdomainコマンドでは、ドメインと使う ml_home_prefix ディレクトリのペ
アを指定します。このコマンドは /usr/local/etc/fml/ml_home_prefix ファ
イルの編集を代行します。上の例では ml_home_prefix ファイルに次の行を追
加します。
<screen>
nuinui.net /var/spool/virtual/nuinui.net
</screen>
ちなみに、消す場合は rmdomain コマンドです。
</para>

<para>
newml コマンドは引数のＭＬ名をドメイン名つきにする以外、デフォルトドメ
インの場合と同じです。
</para>

<para>
また、バーチャルドメインの場合は、各 MTA ごとのバーチャルドメインの設
定見本を作ります。
<screen>
/var/spool/ml/etc/sendmail/virtusertable
/var/spool/ml/etc/postfix/virtual
</screen>
注: 
qmail や procmail にはバーチャル用の設定が特にあるわけではありません。
</para>

<para>
詳しくは、
<link linkend="virtualdomain">
バーチャルドメイン
</link>
の章を参照して下さい。
</para>

</sect1>


<!-- メールサーバの設定について -->
&sect.setup.postfix;
&sect.setup.qmail;


<!-- 各ＭＬの設定について -->
&sect.setup.config.cf;


<!-- レシピ -->
&sect.setup.newml.recipes;

</chapter>
