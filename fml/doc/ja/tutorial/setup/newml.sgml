<!--
   $FML: newml.sgml,v 1.9 2005/06/25 15:11:37 fukachan Exp $
-->


<chapter id="setup.newml">
	<title>
	UNIX 上でＭＬを作成する
	</title>


<sect1 id="setup.newml.default">
	<title>
	makefml newml でＭＬを作る (デフォルトドメインの場合)
	</title>

<caution>
<para>
デフォルトドメインの場合、&fml4 と同じで構いません。
バーチャルドメインを使う場合、ちょっと違います。
バーチャルドメインについては
<link linkend="setup.newml.nondefault">
<xref linkend="setup.newml.nondefault">
</link>
を参照して下さい。
</para>
</caution>

<para>
ＭＬの作成は makefml を使って行ないます。
使い方は &fml4; と同様です。
<screen>
% su fml
% makefml newml elena
   ... 処理の様子が出力される(略) ...
</screen>
デフォルトの /var/spool/ml 以外のパスを使いたい場合は
makefml newdomain コマンドでパスを指定して下さい。
<screen>
% su root
# makefml newdomain fml.org /var/spool/virtual/fml.org
# exit
% su fml
% makefml newml elena
   ... 処理の様子が出力される(略) ...
</screen>

</para>


<para>
makefml newml は実行時、次のような処理を行ないます。

<itemizedlist>

   <listitem>
        <para>
	/var/spool/ml/elena に
	<screen>
	config.cf
	include
	include-ctl
	</screen>
	などを作る(適宜、elena やドメインの値を変換しながら)。
        </para>
   </listitem>

   <listitem>
        <para>
	/var/spool/ml/etc/mail/aliases に elena の設定を仕込む。
	postalias コマンドで
	/var/spool/ml/etc/mail/aliases.db を再生成する。
        </para>
   </listitem>

   <listitem>
        <para>
	~fml/.qmail-* ファイル群を生成する。
        </para>
   </listitem>

   <listitem>
        <para>
	procmailrc の見本を作る。
        </para>
   </listitem>

   <listitem>
        <para>
	HTML 化された記事を置く場所として以下の階層を用意する/作る。
	<screen>
	~fml/public_html/fml/mlarchive/$domain/$ml/
	</screen>
	例えば elena@fml.org なら
	<screen>
	~fml/public_html/fml/mlarchive/fml.org/elena/
	</screen>
	を用意する。
	デフォルトでは、
	ここに HTML 化された記事が自動的に作られることになる。
        </para>
   </listitem>

   <listitem>
        <para>
	CGI インターフェイスを用意する。
	ドメインで一番偉いインターフェイス(そのドメインのＭＬは全部操
	作できる)が
	<screen>
	~fml/public_html/cgi-bin/fml/$domain/admin/config.cgi
	</screen>
	また、各ＭＬで一番偉いインターフェイス(そのＭＬの操作ができる)
	<screen>
	~fml/public_html/cgi-bin/fml/$domain/ml-admin/$ml/config.cgi
	</screen>
        </para>
   </listitem>

</itemizedlist>
</para>

</sect1>


<sect1 id="setup.newml.nondefault">
	<title>
	makefml newml でＭＬを作る (デフォルトドメインでは"ない"場合)
	</title>

<caution>
<para>
デフォルトドメインではない場合、&fml4 と異なります。
注意点は、最初に newdomain コマンドを使うところとＭＬ名です。
</para>
</caution>

<para>
ＭＬ作成には makefml を使います。
使い方は &fml4; と同様です。
しかしながらＭＬ名にきちんとドメインまでつけるところが異なります。
注意して下さい。
</para>

<para>
初回は newdomain コマンドによるドメイン定義も必要です。
<screen>
% su root
# makefml newdomain nuinui.net /var/spool/virtual/nuinui.net
# exit
% su fml
% makefml newml elena@nuinui.net
</screen>
二回目以降の場合は
<screen>
% su fml
% makefml newml rudo@nuinui.net
</screen>
だけでかまいません。
</para>

<para>
newdomainコマンドでは、ドメインと使う ml_home_prefix ディレクトリのペ
アを指定します。このコマンドは /usr/local/etc/fml/ml_home_prefix ファ
イルの編集を代行します。上の例では ml_home_prefix ファイルに次の行が追
加されます。
<screen>
nuinui.net /var/spool/virtual/nuinui.net
</screen>
ちなみに、この対応関係を消す場合は rmdomain コマンドです。
</para>

<para>
newml コマンドは、引数のＭＬ名をドメイン名つきにする以外、デフォルトド
メインの場合と操作方法は同じです。
</para>

<para>
また、バーチャルドメインの場合、makefml newml は各 MTA ごとのバーチャ
ルドメイン用設定見本を作ります。たとえば
<screen>
/var/spool/ml/etc/sendmail/virtusertable
/var/spool/ml/etc/postfix/virtual
</screen>
が作られます。
qmail 用の見本は作られません。
な procmail は.procmailrcの見本がドメイン名つきなので別途バーチャル用
という設定はありません。
</para>

<para>
詳しくは、
<link linkend="virtualdomain">
バーチャルドメイン
</link>
の章を参照して下さい。
</para>

</sect1>


<!-- メールサーバの設定について -->
&sect.setup.postfix;
&sect.setup.qmail;


<!-- 各ＭＬの設定について -->
&sect.setup.config.cf;


<!-- レシピ -->
&sect.setup.newml.recipes;

</chapter>
