<!--
   $FML: postfix.sgml,v 1.5 2004/10/06 09:07:37 fukachan Exp $
-->


<sect1 id="install.postfix">
	<title>
	メールサーバの設定 (postfix)
	</title>

<para>
makefml newml を実行するだけでＭＬが自動的に有効になるように、あらかじ
め postfix の設定を変更しておいて下さい。
</para>


<sect2>
	<title>
	デフォルトのドメイン(例: fml.org)
	</title>


<para>
具体的には postfix の /etc/postfix/main.cf を次のようにしておきます。
<screen>
allow_mail_to_commands = alias,forward,include

alias_maps	=	hash:/etc/mail/aliases
			hash:/var/spool/ml/etc/mail/aliases
</screen>
</para>

<warning>
<para>
また mydestination にデフォルトのドメイン(おそらく $mydomain )が
ちゃんと追加されていることを確認して下さい。
</para>
</warning>

</sect2>


<sect2>
	<title>
	バーチャルドメイン(例: nuinui.net)
	</title>

<para>
/etc/postfix/main.cf で
alias_maps と virtual_maps の両方に設定の追加が必要です。
<screen>
allow_mail_to_commands = alias,forward,include

alias_maps	=	hash:/etc/mail/aliases
			hash:/var/spool/ml/etc/mail/aliases
			hash:/var/spool/nuinui.net/etc/mail/aliases

virtual_maps	=	hash:/var/spool/nuinui.net/etc/postfix/virtual

</screen>
makefml newml を実行すると
/var/spool/nuinui.net/etc/mail/aliases
および
/var/spool/nuinui.net/etc/postfix/virtual 
は makefml によって自動的に更新されます。
なお、この場合、ml_home_prefix_maps で
<screen>
nuinui.net /var/spool/nuinui.net
</screen>
という「ドメイン←→ディレクトリ」の定義がなされています。
</para>

<warning>

<para>
&fml8; が作る virtual_maps のファイルは Postfix スタイルの 
virtual_maps です。最近の Postfix には sendmail スタイルというのもあり
ますが、ここでは昔からある postfix スタイルを使っているということに注
意して下さい。
</para>

<para>
mydestination にデフォルトのドメイン(おそらく $mydomain)がちゃんと追加
されていることを確認して下さい。しかし、バーチャルドメイン(ここでは 
nuinui.net)は mydestination に追加する必要はありません。注意して下さい。
</para>

<para>
バーチャルドメインが増えるたびに alias_maps には新しいドメインの 
aliaes を、virtual_maps にも virtual ファイルを追加する必要があります。
</para>

<para>
ちなみに、最近の postfix では virtual_alias_maps というのが正しい変数
名ですが、デフォルト(/etc/postfix/main.cf.default)で
<screen>
virtual_alias_maps = $virtual_maps 
</screen>
となっているため、
virtual_maps でも virtual_alias_maps でもかまいません。
</para>

</warning>

</sect2>


</sect1>
