<!--
   $FML: postfix.sgml,v 1.6 2005/06/25 15:11:32 fukachan Exp $
-->


<sect1 id="install.postfix">
	<title>
	メールサーバの設定 (Postfix)
	</title>

<para>
makefml newml を実行するだけでＭＬが自動的に有効になるように、
次のように Postfix の設定を変更して下さい。
</para>

<caution>
<para>
一つのドメインについては、一度 Postfix の設定をすれば、あとは makefml 
ないしは fml コマンドの操作だけでＭＬの作成、削除が可能になりますが、
別のドメインを使うなら、ドメインごとに Postfix の alias_maps と 
virtual_maps の追加設定が必要になることに注意して下さい。
</para>


</caution>


<sect2>
	<title>
	Postfix からプログラムを実行可能にする。	
	</title>

<para>
<screen>
allow_mail_to_commands = alias,forward,include
</screen>
の設定を入れて下さい。
これはＭＬドライバを実行するためにどんなケースでも必須の設定です。
</para>

</sect2>


<sect2>
	<title>
	デフォルトのドメイン(例: fml.org)
	</title>


<para>
具体的には postfix の /etc/postfix/main.cf を次のようにしておきます。
<screen>
# Postfix からプログラムを実行可能にする。
allow_mail_to_commands = alias,forward,include

alias_maps	=	hash:/etc/mail/aliases
			hash:/var/spool/ml/etc/mail/aliases
</screen>
hash:/var/spool/ml/etc/mail/aliases は 
「デフォルトのＭＬスプール/etc/mail/aliases」です。
CUI で newml コマンドを実行すると、画面上で
hash:/var/spool/ml/etc/mail/aliases 
ファイルをアップデートしていることが表示されるのでパスを確認してみて下
さい。
newml コマンドの使い方についての詳細は
<link linkend="install.fml.unix">
<xref linkend="install.fml.unix">
</link>
の章を参照。
</para>

<!--
XXX-TODO: newml の際に、Postfix の設定のヒントを表示するべきでしょう。
-->

<warning>
<para>
また mydestination にデフォルトのドメイン(おそらく $mydomain )が
ちゃんと追加されていることを確認して下さい。
</para>
</warning>

</sect2>


<sect2>
	<title>
	バーチャルドメイン(例: nuinui.net)
	</title>

<para>
/etc/postfix/main.cf で
alias_maps と virtual_maps の両方に設定の追加が必要です。
<screen>
# Postfix からプログラムを実行可能にする。
allow_mail_to_commands = alias,forward,include

alias_maps	=	hash:/etc/mail/aliases
			hash:/var/spool/ml/etc/mail/aliases
			hash:/var/spool/nuinui.net/etc/mail/aliases

virtual_maps	=	hash:/var/spool/nuinui.net/etc/postfix/virtual

</screen>
makefml newml を実行すると
/var/spool/nuinui.net/etc/mail/aliases
および
/var/spool/nuinui.net/etc/postfix/virtual 
は makefml によって自動的に更新されます(画面に表示されるので分かるはず)。
なお、この場合、事前に ml_home_prefix_maps で
<screen>
nuinui.net /var/spool/nuinui.net
</screen>
という「ドメイン←→ディレクトリ」の定義がなされています。
newml コマンドの使い方についての詳細は
<link linkend="install.fml.unix">
<xref linkend="install.fml.unix">
</link>
の章を参照。
</para>

<!--
XXX-TODO: newml の際に、Postfix の設定のヒントを表示するべきでしょう。
-->

<warning>

<para>
&fml8; が作る virtual_maps のファイルは Postfix スタイルの 
virtual_maps です。最近の Postfix には sendmail スタイルというのもあり
ますが、&fml8; では昔からある postfix スタイルを使っているということに
注意して下さい。
</para>

<para>
mydestination には、デフォルトのドメイン(おそらく $mydomain)を入れるこ
とが普通ですが、バーチャルドメイン(ここでは nuinui.net)は 
mydestination に追加する必要はありません(Postfix は virtual_maps の値
を見て mydestination 相当であるとみなしています)。注意して下さい。
</para>

<para>
バーチャルドメインが増えるたびに alias_maps には新しいドメインの 
aliaes を、virtual_maps にも virtual ファイルを追加する必要があります。
</para>

<para>
ちなみに、最近の postfix では virtual_alias_maps というのが正しい変数
名ですが、デフォルト(/etc/postfix/main.cf.default)で
<screen>
virtual_alias_maps = $virtual_maps 
</screen>
となっているため、
virtual_maps でも virtual_alias_maps でもかまいません。
</para>

</warning>

</sect2>


</sect1>
