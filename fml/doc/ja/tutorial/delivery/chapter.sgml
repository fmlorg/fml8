<!--
   $FML: chapter.sgml,v 1.12 2003/04/15 14:51:37 fukachan Exp $
-->


<chapter id="delivery">
	<TITLE>
	&fml8; のメール配送システム
	</TITLE>


<sect1 id="fml8-delivery">
	<title>
	&fml4; と &fml8; の相違点
	</title>

<para>
&fml8; の最大の目的の一つは、メンバーリストの取得操作におけるコー
ドの統合と抽象化です。配送には抽象化された Mail::Delivery クラスを次の
ように使います。
</para>

<para>
Mail::Delivery::* に属するクラスは SMTP および LMTP 配送へのインターフェ
イスを提供します。
つまり
Mail::Delivery は
Mail::Delivery 以下の派生クラス
SMTP
ESMTP
LMTP
へのインターフェイスを提供するアダプター層です。
</para>

<para>
例えば次のように使います。
<screen>
    use Mail::Delivery::SMTP;
    my $service = new Mail::Delivery::SMTP;
    if ($service->error) { Log($service->error); return;}

    $service->deliver(
                      {
                          mta             => '127.0.0.1:25',

                          smtp_sender     => 'rudo@nuinui.net',
                          recipient_maps  => $recipient_maps,
                          recipient_limit => 1000,

                          mesage          => $message
                      });
</screen>
ここで $message は
<link linkend="module.mail.message">
Mail::Message
</link>
オブジェクトです。
</para>

</sect1>


<sect1>
	<title>
	<link linkend="module.mail.message">
	Mail::Message
	</link>
	オブジェクト
	</title>

<para>
このオブジェクトはメールを解析し、
<screen>
header -> body
header -> preamble -> part1 -> part2 -> trailor (multipart)
</screen>
のようにオブジェクトが数珠つなぎのようなデータ構造を作ります。
</para>

<para>
<link linkend="module.mail.message">
Mail::Message
</link>
クラスはこのようなデータ構造を操作するメソッドを提供しています。
</para>

</sect1>


<!-- mail queue -->
&sect.mailqueue;


<sect1 id="delivery.qmgr">
	<title>
	キュー管理システム
	</title>

<!--
   XXX-TODO: もっと、キュー管理システムについて詳しく書いて！
-->

<para>
2004 夏以降、&fml8; の配送システムはキュー管理システムのもとで動いてい
ます。これにより再送処理が可能となりました。
</para>

</sect1>


<sect1>
	<title>
	議論: FML::Mailer は必要か？
	</title>

<para>
FML::Process::QueueManager が使っているのみなので
独立したモジュールである必要があるだろうか？
</para>

<para>
reply_message() が何でもしてしまうので、
FML::Mailer を呼ぶことはないかもしれない。
でも、 reply_message() 以外の送信メソッドがあり得るかもしれないね。
</para>

<para>
将来、どうも使ってないようなら
FML::Process::QueueManager に合併するべきかもしれない。
</para>

</sect1>


<sect1 id="recipes.delivery">
	<title>
	配送に関する TIPS 	
	</title>

<qandaset>

&recipe.delivery.forward;

</qandaset>

</sect1>


</chapter>
