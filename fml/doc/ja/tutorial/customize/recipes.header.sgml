<!--
 $FML: recipes.header.sgml,v 1.2 2006/01/13 00:07:14 fukachan Exp $
-->

<qandaset>

<qandaentry>

<question>
<para>
記事のヘッダの Subject: のタグを大文字にしたい
</para>
</question>

<answer>
<para>
<screen>
article_subject_tag = [\U$ml_name\E:%05d]
</screen>
(注意: この機能を使う場合には 2002/10/29 以降の snapshot を使ってください)。 
</para>
</answer>

</qandaentry>


<qandaentry>

<question>
<para>
記事のヘッダの Subject: のタグを小文字にしたい
</para>
</question>

<answer>
<para>
Unix 上では、たいてい小文字を使うので、ＭＬ名前も小文字でしょう。
だから、普通は何もしなくても小文字のはずですが、
念のため、小文字を強制したいなら、つぎのようにしてください。
<screen>
article_subject_tag = [\L$ml_name\E:%05d]
</screen>
(注意: この機能を使う場合には 2002/10/29 以降の snapshot を使ってください)。 
</para>
</answer>

</qandaentry>


<qandaentry>

<question>
<para>
いつでも Reply-To: を投稿用アドレスに強制する。
</para>
</question>

<answer>
<para>
次の HOOK を config.cf の最後(=cutより後)に書いて下さい。
<screen>
$article_header_rewrite_end_hook = q{
    my $ml = $config->{ article_post_address };
    $header->replace('Reply-To', $ml);
};
</screen>
なおヘッダ書き換えルールに以下の命令を追加しても同じことが出来ます。
<screen>
article_header_rewrite_rules += rewrite_reply_to_enforce_article_post_address
</screen>
</para>
</answer>

</qandaentry>


<qandaentry>

<question>
<para>
Reply-To: を送信者に設定する。
</para>
</question>

<answer>
<para>
次の HOOK を config.cf の最後(=cutより後)に書いて下さい。
<screen>
$article_header_rewrite_end_hook = q{
    my $cred   = $curproc->credential();
    my $sender = $cred->sender();

    $header->replace('Reply-To', $sender);
};
</screen>

</para>
</answer>

</qandaentry>


<qandaentry>

<question>
<para>
Reply-To: を「送信者 ＋ ＭＬ」に設定する。
</para>
</question>

<answer>
<para>
次の HOOK を config.cf の最後(=cutより後)に書いて下さい。
<screen>
$article_header_rewrite_end_hook = q{
    my $ml     = $config->{ article_post_address };
    my $cred   = $curproc->credential();
    my $sender = $cred->sender();

    $header->replace('Reply-To', "$ml, $sender");
};
</screen>

</para>
</answer>

</qandaentry>


<qandaentry>

<question>
<para>
ＭＬメンバーからの投稿であれば、Reply-To: を「送信者＋ＭＬ」にする。
</para>
</question>

<answer>
<para>
次の HOOK を config.cf の最後(=cutより後)に書いて下さい。
<screen>
$article_header_rewrite_end_hook = q{
    my $ml     = $config->{ article_post_address };
    my $cred   = $curproc->credential();
    my $sender = $cred->sender();

    if ($cred->is_member($sender)) {
	$curproc->log("member");
	$header->replace('Reply-To', "$ml, $sender");
    }
};
</screen>

</para>
</answer>

</qandaentry>


<qandaentry>

<question>
<para>
To: と Cc: の中にある fml8 が管理しているＭＬのアドレスだけを
Reply-To: に設定する。
</para>
</question>

<answer>
<para>
だいぶ複雑ですが HOOK で実現できます。
次の HOOK を config.cf の最後(=cutより後)に書いて下さい。
<screen>
$article_header_rewrite_end_hook = q{
    my $to   = $header->get('to');
    my $cc   = $header->get('cc');
    my $addr = "$to, $cc";

    use Mail::Address;
    my (@addrlist) = Mail::Address->parse($addr);

    my $reply_to = '';
    for my $a (@addrlist) {
        my $_addr = $a->address;
        if ($curproc->is_fml8_managed_address($_addr)) {
            $reply_to .= $reply_to ? ", $_addr" : $_addr;
        }
    }

    $header->replace('Reply-To', $reply_to) if $reply_to;
};
</screen>

</para>
</answer>

</qandaentry>


</qandaset>
