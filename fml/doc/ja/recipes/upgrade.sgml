<!--
   $FML: upgrade.sgml,v 1.1 2002/04/23 12:55:53 fukachan Exp $
-->

<chapter id="upgrade">
	<title>
	アップグレード
	</title>


<qandaset>
<qandaentry>
<question>
	<para>
	ケーススタディ: fml 4.0 ベースのＭＬを fml-devel に移行する
	</para>
</question>

<answer>

<para>
ここでは old ホストの fml 4.0 から new ホストの fml-devel へ移行するこ
とを考えます。新旧共に elena@fml.org ML としましょう。
</para>


<itemizedlist>

   <listitem>
	<para>
	new ホストに fml-devel をインストールする。
	</para>
   </listitem>

   <listitem>
	<para>
	new ホストで 
	<screen>
	makefml newml elena
	</screen>
	作成後、
	<screen>
	fmlconf -n elena
	</screen>
	でデフォルト値と異なる値が何かを見ておきます。
	</para>
   </listitem>


   <listitem>
	<para>
	MTA (ここでは postfix) の設定
	<screen>
	postmap /var/spool/ml/etc/mail/aliases
	</screen>
	を実行して下さい。そして
	/etc/postfix/main.cf の $alias_maps に
	<screen>
	hash:/var/spool/ml/etc/mail/aliases
	</screen>
	を追加して下さい。
	</para>
   </listitem>


   <listitem>
	<para>
	スプールのコピー
	はつまるところ
	『old ホストから new ホストへスプールをコピーする』ことです。
	<screen>
	% id
	uid=100(fml) gid=1000(fml) groups=1000(fml)
	% mkdir /var/spool/ml.old
	% rsync -av fml@old:/var/spool/ml/ /var/spool/ml.old/
	</screen>
	</para>

	<para>
	ケース 1: (subdir なしの)スプールを作る場合
	<screen>
	% cp -pr /var/spool/ml.old/elena/spool /var/spool/ml/elena
	% cp     /var/spool/ml.old/elena/seq   /var/spool/ml/elena
	</screen>
	でよいです。
	</para>

	<para>
	ケース 2: (subdir ありの)スプールを作る場合。
	@fml.org 全体で subdir をデフォルトにするなら
	/etc/fml/site_default_config.cf に
	<screen>
	spool_type	= subdir
	</screen>
	を追加する。その後
	<screen>
	% fmlspool --convert --srcdir=/var/spool/ml.old/elena/spool elena
	</screen>
	</para>
   </listitem>


   <listitem>
	<para>
	HTML 形式の記事を作る
	<screen>
	% makefml htmlify elena
	</screen>
	</para>
   </listitem>


   <listitem>
	<para>
	CGI のために .htaccess を編集して下さい。
	</para>
   </listitem>


</itemizedlist>

</answer>
</qandaentry>
</qandaset>

</chapter>
